<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no,minimum-scale=1.0, maximum-scale=1.0" />
    <title>消息中心</title>

    <meta name="keywords" content="消息中心">
    <meta name="description" content="平台首创操盘人和投资人线上合作交易模式（品种有股指期货、黄金、白银、原油），让有能力的操盘人提供交易买卖指令，有资金的投资人提供交易资金，双方按约定共享收益共担风险。">
    
    <link rel="stylesheet" href="../content/assets/css/page/Message/merge.css">

    <script type="text/javascript">
        var __baseDir = 'http://'+window.location.host+'/content/';
    </script>
    
    <script>
		document.getElementsByTagName('html')[0].style.fontSize = '100px'; 
	</script>
	
	<script src="../content/assets/js/biz/jquery-1.12.1.min.js"></script>
</head>
<body>

<!-- 头部 -->
<header class="head">
    <div class="content">
        <div>
            <a href="../mine.html" class="icon-youjiantou back"></a>
        </div>
        <h3>消息中心</h3>
    </div>
</header>

<!-- 内容 -->
<section id="main">
   
    <div class="mainTop">
        <div class="active">
            系统消息
            <span class="right_border"></span>
        </div>
        <div>交易提醒</div>
    </div>
    
    <div class="mainCen show xitong">
        <ul>
            <!--<li>
                <a href="">
                   <div class="liMain">
                        <h4>11111111111</h4>
                        <span>1232-1-1</span>
                        <p>测试文字测试文字测试文字测试文</p>
                    </div>
                </a>
            </li>-->
        </ul>
        <div class="toMost Most1">加载更多</div>
    </div>
    
    <div class="mainCen jiaoyi">
        <ul>
        
        </ul>
        <div class="toMost Most2">加载更多</div>
    </div>
</section>

<script>
    var $main = $('#main');
    var $mainTop = $main.find('.mainTop').find('div');
    var $mainCen = $main.find('.mainCen');
    var $Most1 = $('.Most1');
    var $Most2 = $('.Most2');
    var Url = 'http://' + window.location.host;
    var oldUrl = Url + '/news/Message.html';
    var token = localStorage.getItem('token');
    var iNow1 = 0;
    var iNow2 = 0;
    
    
    //判断在系统消息还是在交易提醒页面
    var reg = new RegExp("(^|&)key=([^&]*)(&|$)", "i");
    var r = window.location.search.substr(1).match(reg);
    if( r != null){
        $mainTop.removeClass('active');
        $($mainTop).eq(1).addClass('active');
        $mainCen.css('display','none');
        $mainCen.eq(1).css('display','block');
    }
    
    if(($($mainTop).eq(1).attr('class') == 'active') && (token == null)){
    //    /user/login.html
        window.location.href= '../user/login.html?callback=/news/Message.html';
    }
    
    $mainTop.eq(0).on('click',function(){
        $mainTop.removeClass('active');
        $(this).addClass('active');
        $mainCen.css('display','none');
        $mainCen.eq(0).css('display','block');
        
        history.replaceState({},null,oldUrl);
    });
    
    $mainTop.eq(1).on('click',function(){
        $mainTop.removeClass('active');
        $(this).addClass('active');
        $mainCen.css('display','none');
        $mainCen.eq(1).css('display','block');
        
        if(token == null){
           window.location.href= '../user/login.html?callback=/news/Message.html?key=trade'; 
        }
        else{
            history.replaceState({},null,oldUrl+'?key=trade')
        }  
    });
    
    toMost1()
    
    $Most1.on('click',function(){
        iNow1++;
        toMost1(iNow1)
    });
    
    function toMost1(p){
        $.ajax({
            url : '/sms/message/systemMessages',
            data : { pageNo:p || 1, pageSize:10, token: localStorage.getItem('token')},
            type : 'POST',
            dataType : 'json',
            success : function(data){
                if(data.code == 200){
                    var $xitong = $('#main').find('.xitong').find('ul');
                    var $mainCen = $('#main').find('.mainCen').eq(0);

                    if(data.data.length == 0){
                        if( iNow1 != 0 ){
                            $Most1.hide();
                        }
                        else{
                            $Most1.hide();
                            var $div = $('<div class="textNone">目前没有系统消息</div>');
                            $mainCen.append($div);
                        }
                    }
                    else{
                        for(var i=0;i<data.data.length;i++){
                            var $li = $('<li><a href="detailed.html?id='+data.data[i].id+'"><div class="liMain"><h4>'+data.data[i].title+'</h4><i>'+data.data[i].updateDate+'</i><div>'+data.data[i].content+'</div></div></a></li>');
                            $xitong.append($li);
                        }
                    }
                }
            }
        });
    };
    
    toMost2()
    
    $Most2.on('click',function(){
        iNow2++;
        toMost2(iNow2)
    });
    
    function toMost2(p){
        $.ajax({
            url : '/sms/message/traderMassages',
            data : { pageNo:p || 1, pageSize:10, token: localStorage.getItem('token')},
            success : function(data){
                if(data.code == 200){
                    var $jiaoyi = $('#main').find('.jiaoyi').find('ul');
                    var $mainCen = $('#main').find('.mainCen').eq(1);
                    
                    if(data.data.length == 0){
                        if( iNow2 != 0 ){
                            $Most2.hide();
                        }
                        else{
                            $Most2.hide();
                            var $div = $('<div class="textNone">您目前没有交易消息</div>');
                            $mainCen.append($div);
                        }
                    }
                    else{
                        var Time = '';

                        for(var i=0;i<data.data.length;i++){
                            Time = data.data[i].createDate;
                            var $li = $('<li><a href="detailed.html?id='+data.data[i].id+'"><div class="liMain"><h4>'+data.data[i].title+'</h4><i>'+Time+'</i><div>'+data.data[i].content+'</div></div></a></li>');
                            $jiaoyi.append($li);
                        }
                    }
                }
            }
        });
    };
</script>
    
</body>
</html>